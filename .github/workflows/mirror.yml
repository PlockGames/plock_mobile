name: Push on Epitech repository

on:
  push:
    branches:
      - dev      
jobs: 
  build:
    if: github.repository == 'PlockGames/plock_mobile'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          token: ${{ secrets.AUTOMNE_TOKEN }}

      - name: Clone Epitech repo
        uses: GuillaumeFalourd/clone-github-repo-action@v2.3
        with:
          owner: 'EpitechMscProPromo2025'
          repository: 'T-ESP-800-project_esp800-56365-TLS-tiktok_game'
          branch: 'develop'
          access-token: ${{ secrets.AUTOMNE_TOKEN }}
      - name: Copy code from commit to the cloned repo and git push 
        run: |
          ls T-ESP-800-project_esp800-56365-TLS-tiktok_game/front
          sudo rsync -a . T-ESP-800-project_esp800-56365-TLS-tiktok_game/front/ --exclude T-ESP-800-project_esp800-56365-TLS-tiktok_game
          cd T-ESP-800-project_esp800-56365-TLS-tiktok_game/front
          git push --force
      # - name: Commit files
      #   run: |
      #     git config --local user.email "github-actions[bot]@users.noreply.github.com"
      #     git config --local user.name "github-actions[bot]"
      #     git checkout $GITHUB_REF
      #     git push --force ://github.com/EpitechMscProPromo2025/T-ESP-800-project_esp800-56365-TLS-tiktok_game.git $GITHUB_REF
        env:
          GITHUB_REF: ${{ github.ref }}
